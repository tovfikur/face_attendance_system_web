# =============================================================================
# CCTV Face Attendance System - Backend Environment Configuration
# =============================================================================
# Copy this file to .env and update with your actual values
# DO NOT commit .env to version control
# =============================================================================

# -----------------------------------------------------------------------------
# Application Settings
# -----------------------------------------------------------------------------
APP_NAME=Face Attendance System
APP_VERSION=0.1.0
DEBUG=true
ENVIRONMENT=development  # development, staging, production

# API Settings
API_V1_PREFIX=/api/v1
PROJECT_NAME=Face Attendance API

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
# PostgreSQL Connection
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/face_attendance
DATABASE_ECHO=false  # Set to true for SQL query logging
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=10

# For synchronous operations (Alembic migrations)
SYNC_DATABASE_URL=postgresql://postgres:postgres@localhost:5432/face_attendance

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
REDIS_URL=redis://localhost:6379/0
REDIS_PASSWORD=
REDIS_MAX_CONNECTIONS=50

# Cache settings
CACHE_TTL_DETECTIONS=3  # seconds
CACHE_TTL_CAMERAS=10  # seconds
CACHE_TTL_SYSTEM_SUMMARY=15  # seconds

# -----------------------------------------------------------------------------
# JWT Authentication
# -----------------------------------------------------------------------------
# IMPORTANT: Generate a secure secret key for production
# Example: openssl rand -hex 32
SECRET_KEY=your-secret-key-here-change-in-production-use-openssl-rand-hex-32
ALGORITHM=HS256

# Token expiration
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=14

# -----------------------------------------------------------------------------
# MinIO / S3 Configuration
# -----------------------------------------------------------------------------
MINIO_ENDPOINT=http://localhost:9000
MINIO_ACCESS_KEY=admin
MINIO_SECRET_KEY=password123
MINIO_BUCKET=face-attendance-bucket
MINIO_SECURE=false  # Set to true for HTTPS
MINIO_REGION=us-east-1

# Signed URL expiration (seconds)
PRESIGNED_URL_EXPIRATION=86400  # 24 hours

# -----------------------------------------------------------------------------
# Celery Configuration
# -----------------------------------------------------------------------------
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=["json"]
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=true

# Task time limits (seconds)
CELERY_TASK_TIME_LIMIT=600  # 10 minutes
CELERY_TASK_SOFT_TIME_LIMIT=540  # 9 minutes

# -----------------------------------------------------------------------------
# FFmpeg Configuration
# -----------------------------------------------------------------------------
FFMPEG_PATH=/usr/bin/ffmpeg
FFPROBE_PATH=/usr/bin/ffprobe

# Snapshot settings
SNAPSHOT_TIMEOUT=30  # seconds
SNAPSHOT_FORMAT=jpg
SNAPSHOT_QUALITY=85  # 0-100

# -----------------------------------------------------------------------------
# Detection Provider Configuration
# -----------------------------------------------------------------------------
DETECTION_PROVIDER_ENDPOINT=http://localhost:8001/detect
DETECTION_PROVIDER_API_KEY=
DETECTION_PROVIDER_TIMEOUT=30  # seconds
DETECTION_PROVIDER_RETRY_ATTEMPTS=3

# -----------------------------------------------------------------------------
# Odoo Integration Configuration
# -----------------------------------------------------------------------------
ODOO_BASE_URL=https://your-odoo-instance.com
ODOO_DATABASE=production_db
ODOO_USERNAME=admin
ODOO_PASSWORD=
ODOO_API_KEY=
ODOO_TIMEOUT=60  # seconds

# -----------------------------------------------------------------------------
# CORS Configuration
# -----------------------------------------------------------------------------
# Comma-separated list of allowed origins
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173,http://localhost:8080
ALLOW_CREDENTIALS=true
ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
ALLOWED_HEADERS=*

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=120
RATE_LIMIT_BURST=20

# -----------------------------------------------------------------------------
# Security Settings
# -----------------------------------------------------------------------------
# Encryption key for sensitive data (API keys, etc.)
# Generate with: from cryptography.fernet import Fernet; print(Fernet.generate_key())
ENCRYPTION_KEY=your-encryption-key-here

# Password requirements
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_DIGIT=true
PASSWORD_REQUIRE_SPECIAL=false

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json or text
LOG_FILE=logs/app.log
LOG_MAX_BYTES=10485760  # 10MB
LOG_BACKUP_COUNT=5

# -----------------------------------------------------------------------------
# File Upload Settings
# -----------------------------------------------------------------------------
MAX_UPLOAD_SIZE=10485760  # 10MB in bytes
ALLOWED_IMAGE_EXTENSIONS=jpg,jpeg,png
MAX_FACE_IMAGES_PER_PROFILE=5

# -----------------------------------------------------------------------------
# Export Settings
# -----------------------------------------------------------------------------
EXPORT_EXPIRATION_DAYS=7
EXPORT_MAX_ROWS=100000

# -----------------------------------------------------------------------------
# System Monitoring
# -----------------------------------------------------------------------------
METRICS_COLLECTION_INTERVAL=60  # seconds
CAMERA_HEALTH_CHECK_INTERVAL=120  # seconds
DETECTION_PROVIDER_HEALTH_CHECK_INTERVAL=300  # seconds

# Thresholds
CPU_USAGE_WARNING_THRESHOLD=80  # percent
MEMORY_USAGE_WARNING_THRESHOLD=85  # percent
DISK_USAGE_WARNING_THRESHOLD=90  # percent

# -----------------------------------------------------------------------------
# Data Retention
# -----------------------------------------------------------------------------
DETECTIONS_RETENTION_DAYS=90
AUDIT_LOGS_RETENTION_DAYS=365
SYSTEM_METRICS_RETENTION_DAYS=30
EXPORT_JOBS_RETENTION_DAYS=7

# -----------------------------------------------------------------------------
# WebSocket Configuration
# -----------------------------------------------------------------------------
WEBSOCKET_PING_INTERVAL=30  # seconds
WEBSOCKET_PING_TIMEOUT=10  # seconds
WEBSOCKET_MAX_CONNECTIONS=1000

# -----------------------------------------------------------------------------
# Timezone & Localization
# -----------------------------------------------------------------------------
DEFAULT_TIMEZONE=UTC
DEFAULT_LANGUAGE=en

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
FEATURE_WEBSOCKET_ENABLED=true
FEATURE_ODOO_SYNC_ENABLED=true
FEATURE_DETECTION_PROVIDER_ENABLED=true
FEATURE_EXPORT_PDF_ENABLED=true
FEATURE_FACE_REGISTRATION_ENABLED=true

# -----------------------------------------------------------------------------
# Development / Testing
# -----------------------------------------------------------------------------
# Set to true to enable test mode (uses in-memory DB, etc.)
TESTING=false

# Seed database with mock data on startup
SEED_DATABASE=false

# Enable SQL query logging
SQL_ECHO=false

# -----------------------------------------------------------------------------
# Production Settings (Override in production)
# -----------------------------------------------------------------------------
# In production, set these via environment variables, not in .env file:
# - SECRET_KEY (use a strong random key)
# - DATABASE_URL (use connection pooling)
# - REDIS_URL (use password authentication)
# - MINIO_SECURE=true (use HTTPS)
# - DEBUG=false
# - ENVIRONMENT=production
# - LOG_LEVEL=WARNING
# =============================================================================
